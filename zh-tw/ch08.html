<!doctype html>
<html lang="zh-TW">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html,
      body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia('(prefers-color-scheme: dark)').matches
      if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
        document.documentElement.classList.toggle('dark', true)
      }
    </script>
    <title>第 8 章 下沉複雜性 | 軟體設計的哲學，第二版</title><meta name="description" content="">
    <link rel="preload" href="/aposd-zh/assets/style-DQ_wQnlu.css" as="style"><link rel="stylesheet" href="/aposd-zh/assets/style-DQ_wQnlu.css">
    <link rel="modulepreload" href="/aposd-zh/assets/app-Ci5cuTtk.js"><link rel="modulepreload" href="/aposd-zh/assets/ch08.html-_VuIdvzO.js">
    <link rel="prefetch" href="/aposd-zh/assets/index.html-CoXuya7z.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch01.html-CFgI-9K7.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch02.html-Dprsy5U_.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch03.html-B0GHB072.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch04.html-DDYVLjeD.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch05.html-Dx4ccEf6.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch06.html-CfZqaxQl.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch07.html-B52BajHK.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch08.html-2Sbf8Mpn.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch09.html-C8NfmDZC.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch10.html-lnpfEecG.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch11.html-_NH8QRtO.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch12.html-BxDRqlzL.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch13.html-MPiHaV0S.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch14.html-DY0HtoJl.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch15.html-Bqshj7RR.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch16.html-DY4EuuUI.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch17.html-C-VvN_e1.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch18.html-71II9ptJ.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch19.html-CjvlDPQ4.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch20.html-359jgNQE.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch21.html-CYGJnNwy.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/preface.html-Nmv6DJLK.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/summary.html-D4w9eNU5.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/index.html-CZJtMN8E.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch01.html-Ryv0h8Lw.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch02.html-BHzBaUDG.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch03.html-DhPanKNF.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch04.html-DxYu_JAl.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch05.html-CEP96HVY.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch06.html-Ne45Kn-v.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch07.html-BqsAgz-j.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch08.html-DV5-sTiG.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch09.html-BCaXSg75.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch10.html-Cg5A1Ff9.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch11.html-CZSlD6aS.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch12.html-Ciovq623.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch13.html-lQ1OA727.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch14.html-CSYLYwUZ.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch15.html-BKFscNCX.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch16.html-gnJZ67oV.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch17.html-Cqql9g7r.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch18.html-Z_VfMgcu.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch19.html-fuDb5KrP.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch20.html-7d0SZfgr.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch21.html-CDZtQ-yS.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/preface.html-X7Hkwp3S.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/summary.html-ZVVd1Rcq.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/index.html-C5v0lett.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch01.html-DoSx3CiL.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch02.html-gZw-rlSS.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch03.html-Cz4vDU9Y.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch04.html-Cl3zH71k.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch05.html-BhCL_mku.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch06.html-DwlBmEKl.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch07.html-Djcs8L9u.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch09.html-CXUvZPGP.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch10.html-BmGG5EiH.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch11.html-vDCpMWPd.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch12.html-rF_A_ir-.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch13.html-bZt6qM6I.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch14.html-B6jWNXFz.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch15.html-Cs08_Cn-.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch16.html-J7J2k_IH.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch17.html-BVhCYSB3.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch18.html-CqWUi3X8.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch19.html-Ct4tSDeg.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch20.html-DZYeuyfj.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/ch21.html-3G8ikRL-.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/preface.html-BKnNbDFS.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/summary.html-CveOTmtM.js" as="script"><link rel="prefetch" href="/aposd-zh/assets/404.html-Blv32J2V.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/aposd-zh/zh-tw/"><!----><span class="site-name" aria-hidden="true">軟體設計的哲學，第二版</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide" aria-label="site navigation"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">選擇語言</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">選擇語言</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/aposd-zh/ch08.html" aria-label="简体中文"><!--[--><!--[--><!--]--> 简体中文 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/aposd-zh/en/ch08.html" aria-label="English"><!--[--><!--[--><!--]--> English <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link route-link-active" href="/aposd-zh/" aria-label="繁体中文"><!--[--><!--[--><!--]--> 繁体中文 <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/yingang/aposd-zh" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items" aria-label="site navigation"><!--[--><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">選擇語言</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">選擇語言</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a class="route-link" href="/aposd-zh/ch08.html" aria-label="简体中文"><!--[--><!--[--><!--]--> 简体中文 <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link" href="/aposd-zh/en/ch08.html" aria-label="English"><!--[--><!--[--><!--]--> English <!--[--><!--]--><!--]--></a></li><li class="navbar-dropdown-item"><a class="route-link route-link-active" href="/aposd-zh/" aria-label="繁体中文"><!--[--><!--[--><!--]--> 繁体中文 <!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a class="external-link" href="https://github.com/yingang/aposd-zh" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">第 8 章 下沉複雜性 <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a class="route-link sidebar-item" href="#_8-1-示例-編輯器文字類" aria-label="8.1 示例：編輯器文字類"><!--[--><!--[--><!--]--> 8.1 示例：編輯器文字類 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#_8-2-示例-配置引數" aria-label="8.2 示例：配置引數"><!--[--><!--[--><!--]--> 8.2 示例：配置引數 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#_8-3-做過頭了" aria-label="8.3 做過頭了"><!--[--><!--[--><!--]--> 8.3 做過頭了 <!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link sidebar-item" href="#_8-4-結論" aria-label="8.4 結論"><!--[--><!--[--><!--]--> 8.4 結論 <!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><h1 id="第-8-章-下沉複雜性" tabindex="-1"><a class="header-anchor" href="#第-8-章-下沉複雜性"><span>第 8 章 下沉複雜性</span></a></h1><p>本章介紹了有關如何建立更深的類的另一種思考方式。假設您正在開發一個新模組，並且發現了一個不可避免的複雜性。那麼，是應該讓模組的使用者處理複雜性，還是應該在模組內部處理複雜性？如果複雜性與模組提供的功能有關，則第二個答案通常是正確的答案。大多數模組的使用者會多於其開發人員，因此麻煩開發人員比麻煩使用者更好。作為模組開發人員，您應該努力使模組使用者的生活儘可能輕鬆，即使這對您來說意味著額外的工作。表達此想法的另一種方式是，<strong>讓模組的介面簡單比讓其實現簡單更為重要</strong>。</p><p>作為開發人員，很容易以相反的方式行事：解決簡單的問題，然後將困難的問題推給其他人。如果出現不確定如何處理的情況，最簡單的方法是丟擲異常並讓呼叫者處理它。如果不確定要實施什麼策略，則可以定義一些配置引數來控制該策略，然後由系統管理員自行確定最佳策略。</p><p>這樣的方法短期內會使您的生活更輕鬆，但它們會加劇複雜性，因為許多人都必須處理一個問題，而不僅僅是一個人。例如，如果一個類丟擲異常，則該類的每個呼叫者都必須處理該異常。如果一個類匯出配置引數，則每個系統管理員在每次安裝中都必須學習如何設定它們。</p><h2 id="_8-1-示例-編輯器文字類" tabindex="-1"><a class="header-anchor" href="#_8-1-示例-編輯器文字類"><span>8.1 示例：編輯器文字類</span></a></h2><p>考慮為影象介面文字編輯器管理檔案文字的類，這在 <a class="route-link" href="/aposd-zh/zh-tw/ch06.html">第 6 章</a> 和 <a class="route-link" href="/aposd-zh/zh-tw/ch07.html">第 7 章</a> 中討論過。該類提供了將檔案從磁碟讀入記憶體、查詢和修改檔案在記憶體中的副本以及將修改後的版本寫回磁碟的方法。當學生們要實現這個類時，許多人選擇了面向行的介面，該介面具有讀取、插入和刪除整行文字的方法。這導致了類實現起來很簡單，但也為更高層級的軟體帶來了複雜性。在使用者介面的層級，很少涉及整行操作。例如，擊鍵會導致在現有行中插入單個字元；複製或刪除選擇的區域可能同時修改幾個不同的行。使用面向行的文字介面，更高層級的軟體必須自行拆分和連線行以實現使用者介面。</p><p>面向字元的介面（如 <a class="route-link" href="/aposd-zh/zh-tw/ch06.html">第 6.3 節</a> 中所述）下沉了複雜性。使用者介面軟體現在可以插入和刪除任意範圍的文字，而無需拆分和連線行，因此變得更加簡單。文字類的實現可能會變得更加複雜：如果內部將文字表示為行的集合，則必須拆分和連線行以實現面向字元的操作。但這種方法更好，因為它在文字類中封裝了拆分和連線的複雜性，從而降低了系統的整體複雜性。</p><h2 id="_8-2-示例-配置引數" tabindex="-1"><a class="header-anchor" href="#_8-2-示例-配置引數"><span>8.2 示例：配置引數</span></a></h2><p>配置引數是上升複雜性而不是下沉複雜性的一個示例。類可以輸出一些控制其行為的引數，而不是在內部確定特定的行為，例如快取記憶體的大小或在放棄之前重試請求的次數。然後，該類的使用者必須為引數指定適當的值。在當今的系統中，配置引數已變得非常流行，有些系統有數百個配置引數。</p><p>配置引數的擁護者認為配置引數不錯，因為它們允許使用者根據他們的特定要求和工作負載來調整系統。在某些情況下，低層級的基礎結構程式碼很難知道要應用的最佳策略，而使用者則對其領域更加熟悉。例如，使用者可能知道某些請求比其他請求更緊迫，因此使用者為這些請求指定更高的優先順序是有意義的。在這種情況下，配置引數可以在更廣泛的領域中帶來更好的效能。</p><p>但是，配置引數還提供了一個輕鬆的藉口，可以用來避免處理重要的問題並將其傳遞給其他人。在許多情況下，使用者或管理員很難或無法確定引數的正確值。在其他情況下，可以透過在系統實現中進行一些額外的工作來自動確定正確的值。考慮一個必須處理丟失資料包的網路協議。如果它傳送了請求但在一定時間內未收到響應，則重新發送該請求。確定重試間隔的一種方法是引入配置引數。但是，傳輸協議可以透過測量成功請求的響應時間，並將該響應時間的倍數用於重試間隔，自己計算出一個合理的值。這種方法下沉了複雜性，使其使用者不必自行找出正確的重試間隔。它還具有動態計算重試間隔的額外優點，因此，如果操作條件發生變化，它將自動進行調整。相反，配置引數很容易就過時了。</p><p>因此，您應儘可能避免使用配置引數。在匯出配置引數之前，請問自己：“使用者（或更高層級的模組）是否能夠確定一個比我們在這裡確定的更好的值？” 當您建立配置引數時，請確認是否可以自動計算合理的預設值，以便使用者僅需在特殊情況下提供這個值。理想情況下，每個模組都應完整地解決一個問題。而配置引數導致的是一個不完整的解決方案，從而增加了系統複雜性。</p><h2 id="_8-3-做過頭了" tabindex="-1"><a class="header-anchor" href="#_8-3-做過頭了"><span>8.3 做過頭了</span></a></h2><p>下沉複雜性時要謹慎處理；這個想法很容易做過頭。一種極端的方法是將整個應用程式的所有功能歸為一個類，這顯然沒有意義。如果（a）被下沉的複雜性與該類的現有功能密切相關，（b）下沉複雜性將導致應用程式中許多其他地方的簡化，(c) 下沉複雜性將簡化類的介面，則下沉複雜性最有意義。請記住，目標是最大程度地降低整體的系統複雜性。</p><p><a class="route-link" href="/aposd-zh/zh-tw/ch06.html">第 6 章</a>介紹了學生們如何在文字類中定義了一些反映使用者介面的方法，例如實現退格鍵功能的方法。這似乎很好，因為它可以下沉複雜性。但是，將使用者介面的知識新增到文字類中並不會大大簡化高層級的程式碼，並且使用者介面的知識與文字類的核心功能無關。在這種情況下，下沉複雜性只會導致資訊洩露。</p><h2 id="_8-4-結論" tabindex="-1"><a class="header-anchor" href="#_8-4-結論"><span>8.4 結論</span></a></h2><p>在開發模組時，為了減少使用者的痛苦，要找機會給自己多吃一點苦。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">上次更新: </span><!----></div><!----></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/aposd-zh/assets/app-Ci5cuTtk.js" defer></script>
  </body>
</html>
